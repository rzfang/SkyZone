<style type='text/css'>
<!--
  div.AbtPg { padding: 5px; word-wrap:break-word; white-space: pre-line; }

  #Head, #Tail { text-align: center; }
  #Head > a { text-decoration: none; }

  #GdWdsChk, #AtCnrChk { position: absolute; bottom: 0px; padding: 5px; border-radius: 5px 0px 0px 0px;
                         color: rgba(0, 0, 0, 0.5); background: rgba(255, 255, 255, 0.5);}

  #GdWdsChk { left: 0px; }
  #GdWds { z-index: -1; position: absolute; left: 0px; bottom: 0px; width: 640px; height: 480px; }

  #AtCnrChk { right: 0px; }
  #AtCnr { z-index: -1; position: absolute; right: 0px; bottom: 0px; width: 800px; height: 600px;
           background-position: bottom right; background-repeat: no-repeat; }
  #AtCnr > pre.Block { display: none; position: absolute; right: 30px; bottom: 30px; max-width: 200px;
                       padding: 5px; border-radius: 5px; font-size: 14px; background: rgba(255, 255, 255, 0.7); }
-->
</style>
<script type='text/javascript'>
  //==== Frame library. ================================================================================================

  function FrameShow (Frm, X, Y, ThenF) {
    if (typeof Frm !== 'object') { return 0; }

    X = typeof X !== 'number' ? Frm.css('left') : X;
    Y = typeof Y !== 'number' ? Frm.css('top') : Y;

    if (typeof ThenF !== 'function') { ThenF = function () {}; }

    Frm.get(0).ToFront();

    if (Frm.css('display') !== 'none') {
      Frm.animate({'left': X, 'top': Y});

      return 0;
    }

    let Rdm = Math.round(Math.random() * 3);

    Frm.css({'left': X, 'top': Y});

    switch (Rdm) {
      case 1:
        Frm.slideDown('normal', ThenF);
        break;

      case 2:
        Frm.fadeIn('normal', ThenF);
        break;

      case 0:
      default:
        Frm.show('normal', ThenF);
    }
  }

  function FrameHide (Frm) {
    let Rdm = Math.round(Math.random() * 3);

    switch (Rdm) {
      case 1:
        Frm.slideUp('normal');
        break;

      case 2:
        Frm.fadeOut('normal');
        break;

      case 0:
      default:
        Frm.hide('normal');
    }
  }

  /* get Related Frame Rectangle.
    @ Origin Frame object.
    @ Target Size. [W, H].
    @ Offset Location X and Y. optional.
    < [X, Y, W, H]. */
  function RelatedFrameRectangle (OrgFrm, TgtSz, OfstLct) {
    if (typeof OrgFrm !== 'object' || typeof TgtSz !== 'object') { return 0; }

    if (typeof OfstLct !== 'object' || OfstLct.length < 2) { OfstLct = [0, 0]; }

    let C = $('#Main'), // 'C' = Container.
        CL = C.offset(),
        CR = [CL.left, CL.top, C.innerWidth(), C.innerHeight()], // 'CR' = Container Rectangle.
        OFL = OrgFrm.offset(), // 'OFL' = Origin Frame Location.
        OR = [OFL.left, OFL.top, OrgFrm.innerWidth(), OrgFrm.innerHeight()],
        TR = [OR[0] + OR[2] + OfstLct[0] + 5, OR[1] + OfstLct[1], TgtSz[0], TgtSz[1]]; // 'TR' = Target Rectangle.

    if ((TR[0] + TR[2]) > (CR[2] + CR[0])) { TR[0] = OR[0] - TR[2] - 5 + CR[0] + OfstLct[0]; }
    if (TR[0] < CR[0]) { TR[0] = CR[0] + OfstLct[0]; }

    if ((TR[1] + TR[3]) > (CR[3] + CR[1])) { TR[1] = CR[3] - TR[3] + CR[1] - 5; }
    if (TR[1] < CR[1]) { TR[1] = CR[1] + 5; }

    return TR;
  }

  /* locate a new opened Base Frame X coordinate.
    @ Self Frame of base frames.
    < X location of self frame. */
  function BaseFrameXGet (Self) {
    if (typeof Self !== 'object') { return 0; }

    let BsFrmA = [$('#BlgLstFrm'), $('#MsgBrdFrm'), $('#TtlLstFrm')],
        MaxX = 0,
        MinX = 99999;

    for (let i = 0; i < BsFrmA.length; i++) {
      if (BsFrmA[i] === undefined || BsFrmA[i].length === 0 || Self.attr('id') === BsFrmA[i].attr('id') ||
          BsFrmA[i].css('display') === 'none')
      { continue; }

      let ChkXY = BsFrmA[i].offset();

      MaxX = Math.max(MaxX, (ChkXY.left + BsFrmA[i].width() + 5));
      MinX = Math.min(MinX, (ChkXY.left - 5))
    }

    if (MinX === 99999) { MinX = 0; }

    let SelfW = Self.width();

    return (SelfW < MinX) ? (MinX - SelfW) : MaxX;
  }

  //==== Component. ====================================================================================================

  /* set all element matched with given CSS selector string to be Button0 objects,
     even if the object is not created yet.
    @ CSS Selector string.
    < 'Button0' element jQuery objects, or null.
    Need: jQuery API, CSSAdd(). */
  function Button0 (CSSS) {
    if (typeof CSSS !== 'string') {
      alert('Set \'Button0\' object failed. Please check out passing values.');

      return null;
    }

    CSSS = CSSS.trim();

    $('body').on('mouseenter', CSSS, Evt => { Initialize(Evt.currentTarget); })
             .on('focus', CSSS, Evt => { Initialize(Evt.currentTarget); })
             .find(CSSS).each(() => { Initialize(this); });

    return 0;

    function Initialize (Obj) {
      if (!Obj || typeof Obj.LckFlg === 'boolean') { return; }

      $(Obj).attr('autocomplete', 'off');

      Obj.LckFlg = false; // 'LckFlg' = Locked Flag.
      Obj.Lock = Lock;
      Obj.Unlock = Unlock;
    }

    function Lock () {
      if (this.LckFlg) { return; }

      this.LckFlg = true;

      $(this).addClass('Lock')
             .prop('disabled', true);
    }

    function Unlock () {
      if (!this.LckFlg) { return; }

      this.LckFlg = false;

      $(this).removeClass('Lock')
             .prop('disabled', false);
    }
  }

  /* set a HTML element to be a Item Lister object.
    @ Box DOM Object, jQuery Selector.
    @ service URL.
    @ Limit number of one page, give < 1 as no limit.
    @ post Data, a JSON.
    @ (OneData, Idx), One Item build Function.
      'OneData' = One Data from server.
      'Idx' = Index of Data.
      Return: DOM to append to 'BxOS' DOM.
    @ Index Class. optional. give empty array to skip page index tags builded.
      'IdxCls[0]' = normal class name, give non-string to ignore this state setting.
      'IdxCls[1]' = optional. disable class name, give non-string to ignore this state setting.
    @ (Cnt, Data), After Items build Function. optional.
      'Cnt' = Count of data.
      'Data' = origin Data array.
    < jQuery object of 'BxOS'.
    Extend: PageGet(), Recount(), LimitSet(), NowPage().
    Need: ObjectCombine(). */
  function ItemList (BxOS, URL, Lmt, Data, OneItmF, IdxCls, AftItmsF) {
    if (typeof BxOS === 'undefined' || typeof URL !== 'string' || isNaN(Lmt) || typeof Data !== 'object' ||
        typeof OneItmF !== 'function') {
      alert('Create a \'ItemList\' failed. Please check out passing values.');

      return null;
    }

    Lmt = parseInt(Lmt, 10);

    if (Lmt < 1) { Lmt = 0; }

    let Bx = $(BxOS),
        BxDOM = Bx.get(0),
        NwPg = 0,
        PgTgRng = 2,
        TtlCnt = 0,
        MxPg = 0;

    Bx.data('Data', Data);

    BxDOM.PageGet = OnePageList;
    BxDOM.Recount = TotalCount;
    BxDOM.LimitSet = LimitSet;
    BxDOM.NowPage = () => { return NwPg; };

    TotalCount(() => { OnePageList(NwPg); });

    if (typeof IdxCls === 'object' && IdxCls.length > 0) {
      Bx.off('click', 'div.ItmLstIdxBx:last-child > span')
        .on(
          'click',
          'div.ItmLstIdxBx:last-child > span',
          function (Evt) { // 20120727 by RZ. use class to focus on index list box.
            let This = $(this),
                Idx = parseInt(This.attr('name'), 10);

            if (Idx < 0 || Idx > MxPg || Idx === NwPg) { return 0; }

            let TC = ['', ''];

            if (typeof IdxCls[1] === 'string' && IdxCls[1].length > 0) {
              This.siblings().addBack().removeClass()
                                       .addClass(IdxCls[1]);
            }

            OnePageList(Idx);
          });
    }

    return Bx;

    function OnePageList (Pg) {
      let Tp = typeof Pg;

      if (Tp === 'undefined') { Pg = NwPg; }
      else if (Tp !== 'number') { return 0; }

      let PstData = ObjectCombine(Data, {'Lmt': Lmt, 'Ofst': (Pg * Lmt)}); // 'PstData' = Post Data.

      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: URL,
        data: PstData,
        // beforeSend: (JQXHR, Set) => {},
        // error : (JQXHR, TxtSt, ErrThr) => {},
        // complete : (JQXHR, TxtSt) => {},
        success: (Rtn, TxtSt, JQXHR) => {
          if (Rtn.Index != 0) {
            alert(Rtn.Index + ', ' + Rtn.Message);

            return 0;
          }

          NwPg = Pg;
          Bx.empty();

          for (let i in Rtn.Extend) { Bx.append(OneItmF(Rtn.Extend[i], i)); }

          if (typeof IdxCls === 'object' || IdxCls.length > 1) { PageIndexBuild(); }

          if (typeof AftItmsF === 'function') {
            AftItmsF((typeof Rtn.Extend === 'undefined') ? 0 : Rtn.Extend.length, Rtn.Extend);
          }
        }});
    }

    /* Count Total number.
      'AftF' = After Function, called after TotalCount() finished. optional. */
    function TotalCount (AftF) {
      let PstData = ObjectCombine(Data, {'Cnt': 1, 'Lmt': 0, 'Ofst': 0}); // 'PstData' = Post Data.

      $.ajax({
          type: 'POST',
          dataType: 'json',
          timeout : 20000,
          url: URL,
          data: PstData,
          // beforeSend: (JQXHR, Set) => {},
          // error : (JQXHR, TxtSt, ErrThr) => {},
          // complete : (JQXHR, TxtSt) => {},
          success: (Rtn, TxtSt, JQXHR) => {
            if (Rtn.Index < 0) {
              alert(Rtn.Index + ', ' + Rtn.Message);

              return 0;
            }

            TtlCnt = isNaN(Rtn.Extend) ? Rtn.Extend.length : Rtn.Extend;
            MxPg = Math.ceil(TtlCnt / Lmt) - 1;

            if (Rtn.Extend == 0 && typeof IdxCls === 'object' && IdxCls.length > 1) { PageIndexBuild(); }

            if (typeof AftF === 'function') { AftF(); }
          }});
    }

    /* Reset Limit.
      'NwLmt' = New Limit.
      Return: real setting limit. or original limit without change. */
    function LimitSet (NwLmt) {
      if (typeof NwLmt !== 'number' || NwLmt < 1) { return Lmt; }

      if (NwLmt > 99) { NwLmt = 99; }

      Lmt = NwLmt;

      return Lmt;
    }

    function PageIndexBuild () {
      let IdxLst = $('<div/>').appendTo(Bx),
          TC = ['', '']; // 'TC' = Temptory Class.

      if (typeof IdxCls !== 'object' || IdxCls.length === 0) { return 0; }

      IdxLst.addClass('ItmLstIdxBx') // 20120727 by RZ. for solve 'on - click' event point multiple element, use class to focus on the index box.
            .css({'textAlign': 'center', 'marginTop': 10});

      if (typeof IdxCls[0] === 'string' && IdxCls[0].length > 0) { TC[0] = IdxCls[0]; }

      if (typeof IdxCls[1] === 'string' && IdxCls[1].length > 0) { TC[1] = IdxCls[1]; }

      /*==== first & prev page tag. ====*/

      $('<span/>').addClass(NwPg > 0 ? TC[0] : TC[1])
                  .attr({'name': NwPg > 0 ? 0 : -1, 'title': 1})
                  .text('╞')
                  .appendTo(IdxLst); // first page.

      $('<span/>').addClass(NwPg == 0 ? TC[1] : TC[0])
                  .attr({'name': NwPg - 1})
                  .text('◁')
                  .appendTo(IdxLst); // prev page.

      /*==== now page tag. ====*/

      let Nw = $('<span/>').addClass(TC[1])
                           .attr('name', NwPg)
                           .text(NwPg + 1)
                           .appendTo(IdxLst); // 'Nw' = Now page.

      /*==== last & next page tag. ====*/

      $('<span/>').addClass(NwPg >= MxPg ? TC[1] : TC[0])
                  .attr({'name': NwPg + 1})
                  .text('▷')
                  .appendTo(IdxLst); // next page.

      $('<span/>').addClass(NwPg < MxPg ? TC[0] : TC[1])
                  .attr({'name': NwPg < MxPg ? MxPg : (MxPg + 1), 'title': MxPg + 1})
                  .text('╡')
                  .appendTo(IdxLst); // last page.

      /*==== page index range handle. ====*/

      let PrvBgn = NwPg - PgTgRng,
          PrvEnd = NwPg,
          NxtBgn = NwPg + PgTgRng,
          NxtEnd = NwPg;

      if (PrvBgn < 0) {
        NxtBgn -= PrvBgn;
        PrvBgn = 0;

        if (NxtBgn > MxPg) { NxtBgn = MxPg; }
      }

      if (NxtBgn > MxPg) {
        PrvBgn -= (NxtBgn - MxPg);
        NxtBgn = MxPg;

        if (PrvBgn < 0) { PrvBgn = 0; }
      }

      /*==== prev page tags. ====*/

      for (let i = PrvBgn; i < PrvEnd; i++) { // prev range page tags.
        $('<span/>').addClass(TC[0])
                    .attr({'name': i})
                    .text(i + 1)
                    .insertBefore(Nw);
      }

      /*==== next page tags. ====*/

      for (let i = NxtBgn; i > NxtEnd; i--) {
        $('<span/>').addClass(TC[0])
                    .attr({'name': i})
                    .text(i + 1)
                    .insertAfter(Nw);
      }
    }
  }

  //====================================================================================================================

  EmbedDeny();

  let CO = null; // 'CO' = Cookie Object.

  $(function () {
      Button0('.Btn0');
      GoodWordsSet();
      ArtCornerSet();

      $('#Main').height($(document).height() - $('#Head').height() - $('#Tail').height());

      $(window).resize(function (Evt) {
        $('#Main').height($(Evt.currentTarget).height() - $('#Head').height() - $('#Tail').height());
      });

      CO = CookieParam();

      CO.LfTm = 604800; // 7 days in second.
  });

  function GoodWordsSet () {
    let Str = '',
        Cvs = $('canvas#GdWds'),
        Ctx = null,
        Wds = [];

    NowWordGet();

    return 0;

    function NowWordGet () {
      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: 'service/words/nowone',
        data: null,
        success: function (Data, TxtSt, JQXHR) {
          if (Data.Index < 0) { return -1; }

          Str = Data.Extend.Wds;

          Initialize();
          Animate();
        }});
    }

    function Initialize () {
      Cvs.attr({'width': Cvs.width(), 'height': Cvs.height()});

      Ctx = Cvs.get(0).getContext('2d');
      Ctx.textBaseline = 'middle';

      //==== word info set. ====

      let BsSptA = [40, 25], // 'BsSptA' = Base Seperate Array, [X, Y].
          StrA = Str.replace(/\n|，|；|。| /g, "\n").split("\n"); // 'StrA' = String Array.

      for (let i = 0; i < StrA.length; i++) {
        let BsLct = [80, Ctx.canvas.height - (BsSptA[1] * (StrA.length - i + 1))]; // 'BsLct' = Base Location.

        for (let j = 0; j < StrA[i].length; j++) {
          let Chr = StrA[i].charAt(j);

          let Clr = [RandomRange(64, 128).toString(),
                   RandomRange(64, 192).toString(),
                   RandomRange(64, 255).toString(),
                   RandomRange(0.2, 0.9, 2).toString()];

          let Sz = RandomRange(20, 50);

          let Wd = {'Chr': Chr,
                    'DftLct': [BsLct[0] + (j * BsSptA[0]) + RandomRange(-5, 5), BsLct[1] + RandomRange(-5, 5)],
                    'Lct': [RandomRange(0, Ctx.canvas.width, 2), RandomRange(0, Ctx.canvas.height, 2)],
                    'Drct': [RandomRange(-1, 1, 2), RandomRange(-1, 1, 2)],
                    'Sz': Sz,
                    'Clr': 'rgba(' + Clr[0] + ', ' + Clr[1] + ', ' + Clr[2] + ', ' + Clr[3] + ')',
                    'Fnt': 'italic bold ' + Sz.toString() + 'px sans-serif'};

          Wds.push(Wd);
        }
      }
    }

    function Animate () {
      Ctx.clearRect(0, 0, Ctx.canvas.width, Ctx.canvas.height);

      AlignedStand();
    }

    function AlignedStand () {
      for (let i = 0; i < Wds.length; i++) {
        Wds[i].Lct[0] = Wds[i].DftLct[0];
        Wds[i].Lct[1] = Wds[i].DftLct[1];

        Ctx.font = Wds[i].Fnt;
        Ctx.fillStyle = Wds[i].Clr;
        Ctx.shadowOffsetX = 0;
        Ctx.shadowOffsetY = 0;
        Ctx.shadowBlur = 0;

        Ctx.fillText(Wds[i].Chr, Wds[i].Lct[0], Wds[i].Lct[1]);
      }
    }

    function FreeWalk () {
      for (let i = 0; i < Wds.length; i++) {
        Ctx.font = Wds[i].Fnt;
        Ctx.fillStyle = Wds[i].Clr;
        Ctx.shadowColor = Wds[i].Clr;
        Ctx.shadowOffsetX = 3;
        Ctx.shadowOffsetY = 3;
        Ctx.shadowBlur = 5;

        Ctx.fillText(Wds[i].Chr, Wds[i].Lct[0], Wds[i].Lct[1]);

        Wds[i].Lct[0] += Wds[i].Drct[0];
        Wds[i].Lct[1] += Wds[i].Drct[1];

        if (Wds[i].Lct[0] + Wds[i].Sz < 0) { Wds[i].Lct[0] = Ctx.canvas.width; }
        else if (Wds[i].Lct[0] > Ctx.canvas.width) { Wds[i].Lct[0] = Wds[i].Sz * -1; }

        if (Wds[i].Lct[1] + Wds[i].Sz < 0) { Wds[i].Lct[1] = Ctx.canvas.height; }
        else if ((Wds[i].Lct[1] - Wds[i].Sz) > Ctx.canvas.height) { Wds[i].Lct[1] = Wds[i].Sz * -1; }
      }
    }

    /* make a random number in the range.
      @ minimum number.
      @ maximum number.
      @ Decimal. optional, default 0. give -1 to keep original decimal.
      < random number in the range, or 0 as error. */
    function RandomRange (Min, Max, Dcm) {
      if (typeof Min !== 'number' || typeof Max !== 'number') { return 0; }

      if (typeof Dcm !== 'number') { Dcm = 0; }

      if (Min > Max || Max < Min) {
        let T = Min;

        Min = Max;
        Max = T;
      }

      let Dst =  Max - Min, // 'Dst' = Distance.
          Nbr = Math.random() * Dst + Min;

      if (Dcm === 0) { Nbr = Math.floor(Nbr); }
      else if (Dcm > 0) {
        let Pow = Math.pow(10, Dcm);

        Nbr = Math.floor(Nbr * Pow) / Pow;
      }

      return Nbr;
    }
  }

  function ArtCornerSet () {
    let AtCnr = $('#AtCnr'),
        AtCnrChk = $('#AtCnrChk');

    AtCnrChk.on({
      mouseenter: function (Evt) { AtCnr.children().show(); },
      mouseleave: function (Evt) { AtCnr.children().hide(); }
    });

    RandomOne();

    return AtCnr;

    function RandomOne () {
      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: '/service/artcorner/randomone',
        data: { Cmd: 6 },
        success: function (Data, TxtSt, JQXHR) {
          if (Data.Index < 0) { return -1; }

          AtCnr.css('backgroundImage', 'url("' + Data.Extend.ImgUrl + '")')
               .children().text(Data.Extend.Ttl + "\n" + Data.Extend.Dt.substr(0, 10) + "\nby " + Data.Extend.Atr);
        }});
    }
  }

  function AboutFrame (Ttl) {
    let ID = 'ItdFrm',
        Frm = $('#' + ID);

    if (Frm.length > 0) { return FrameShow(Frm); }

    Frm = Frame('#Main', 640, 480, AboutFrameSet, 'Frm', Ttl, true);

    Frm.attr({'id': ID})
       .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(Frm); });

    let Bs = $('#Main');

    FrameShow(Frm, (Bs.width() - Frm.outerWidth()) / 2, Bs.offset().top + 5);

    return 0;

    function AboutFrameSet () {
      return TabBox('#AbtBx', '#AbtBx > div.AbtPg', 0);
    }
  }

  /*
    Notice: this is a base frame. */
  function BlogListFrame (Ttl) {
    let ID = 'BlgLstFrm',
        BlogLstFrm = $('#' + ID),
        Sz = [280, 520],
        MsgLstFrm = $('#MsgBrdFrm');

    if (BlogLstFrm.length > 0) {
      FrameShow(BlogLstFrm);

      return 0;
    }

    BlogLstFrm = Frame('#Main', Sz[0], Sz[1], BlogListFrameSet, 'Frm', Ttl, true);

    BlogLstFrm.attr({'id': ID})
              .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(BlogLstFrm); });

    FrameShow(BlogLstFrm, BaseFrameXGet(BlogLstFrm));

    return 0;

    function BlogListFrameSet () {
      let LstBx = $('#BlogLstBx'),
          BlogBx = LstBx.parent(),
          OptnBtn = BlogBx.find('> div:first > input:button');

      ItemList(LstBx, '/service/blog/list', 5, {}, OneBlog, ['LstIdxTg', 'LstIdxTgDsb']); // List Recent Blogs.

      OptnBtn.first().on('click', TagListFrame)
                     .end()
             .eq(1).on('click', OneRandomBlogShow);
      LstBx.on('click', '.OneBlog', OneBlogShow);

      return BlogBx;
    }

    function OneBlog (Data, Idx) {
      let Itm = $('#OneBlog').clone().removeAttr('id');

      Itm.attr('id', Data.ID)
         .data('Pswd', Data.Pswd)
         .children('div:first').text(Data.Ttl)
                               .end()
         .children('div:eq(2)').text(Data.Smry)
                               .end()
         .find('> div:last > span:last').text(Data.Dt.substr(0, 10));

      if (typeof Data.Tg === 'object' && Data.Tg.length > 0) {
        for (let i in Data.Tg) {
          let Tg = Data.Tg[i];

          $('<span/>').text(Tg.Nm)
                      .attr('name', Tg.ID)
                      .appendTo(Itm.children('div:eq(1)'));
        }
      }

      if (Data.Pswd.length > 0) {
        let LckIco = $('<span/>');

        LckIco.addClass('IcoBlogTp IcoBlogLck')
              .attr({'title': '上鎖的文章'})
              .prependTo(Itm.find('> div:last > span:last'));
      }

      switch (Data.Tp) {
        case 'text':
          $('<span/>').addClass('IcoBlogTp IcoBlogTxt')
                      .attr({'title': '文章'})
                      .prependTo(Itm.find('> div:last > span:last'));
          break;

        case 'image':
          $('<span/>').addClass('IcoBlogTp IcoBlogImg')
                      .attr({'title': '圖文'})
                      .prependTo(Itm.find('> div:last > span:last'));
          break;

        case 'images':
          $('<span/>').addClass('IcoBlogTp IcoBlogImgs')
                      .attr({'title': '相簿'})
                      .prependTo(Itm.find('> div:last > span:last'));
          break;
      }

      return Itm;
    }

    function OneRandomBlogShow (Evt) {
      Evt.stopPropagation();

      $(Evt.currentTarget).attr({ id: '0123', name: 'random' });

      OneBlogShow(Evt);
    }

    function TagListFrame (Evt) {
      Evt.stopPropagation();

      let ID = 'TgLstFrm',
          Frm = $('#' + ID),
          R = [0, 0];

      if (typeof Frm === 'object' && Frm.length > 0) {
        R = RelatedFrameRectangle(BlogLstFrm, [Frm.outerWidth(), Frm.outerHeight()]);

        FrameShow(Frm, R[0], R[1]);

        return 1;
      }

      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: '/service/tag/list',
        data: {},
        success: function (Rtn, TxtSt, JQXHR) {
          if (Rtn.Index < 0) {
            alert(Rtn.Message);

            return -1;
          }

          let Bx = $('#TgLstBx').children(),
              Lst = Bx.first(),
              Tlt = $('<div><label><input type="checkbox"/><span/></lable></div>');

          for (let i in Rtn.Extend) {
            let Info = Rtn.Extend[i],
                One = Tlt.clone().addClass('OneTg').appendTo(Lst);

            One.children('label').children('input:checkbox').val(Info.ID)
                                                            .end()
                                 .children('span').addClass('Block')
                                                  .text(Info.Nm);
          }

          Bx.eq(1).children('input:button').first().on('click', NoTagFilterList)
                                                   .end()
                                           .eq(1).on('click', TagFilterList);

          Frm = Frame('#Main', 200, 200, function () { return Bx; }, 'Frm', '標籤過濾', true);

          Frm.attr('id', ID)
             .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(Frm); });

          R = RelatedFrameRectangle(BlogLstFrm, [Frm.outerWidth(), Frm.outerHeight()]);

          FrameShow(Frm, R[0], R[1]);
        }});

      return 0;

      function NoTagFilterList (Evt) {
        Evt.stopPropagation();

        $(this).closest('div').prev('div').find('input:checkbox').prop('checked', false);

        ItemList('#BlogLstBx', '/service/blog/list', 5, {'TgIDA': []}, OneBlog, ['LstIdxTg', 'LstIdxTgDsb']); // List Recent Blogs.
        FrameHide(Frm);
      }

      function TagFilterList (Evt) {
        Evt.stopPropagation();

        let TgIDA = [];

        $(this).closest('div').prev('div').find('input:checkbox:checked').each(function (Idx) {
          TgIDA.push($(this).val());
        });

        ItemList('#BlogLstBx', '/service/blog/list', 5, {'TgIDA': TgIDA}, OneBlog, ['LstIdxTg', 'LstIdxTgDsb']); // List Recent Blogs.
        FrameHide(Frm);
      }
    }

    function OneBlogShow (Evt) {
      Evt.stopPropagation();

      let This = $(Evt.currentTarget),
          ID = This.attr('id'),
          Ttl = This.children('div:first').text(),
          Pswd = This.data('Pswd'),
          Rdm = This.attr('name') === 'random';

      if (ID.length === 0) { return -1; }

      let Frm = $('#Frm_' + ID);

      if (Frm.length > 0) {
        let PF = This.closest('.Frm'), // 'PF' = Parent Frame.
            R = RelatedFrameRectangle(PF, [Frm.width(), Frm.height()], [0, This.offset().top - PF.offset().top]);

        FrameShow(Frm, R[0], R[1]);

        return 1;
      }

      BlogOneFrame(ID, Rdm, Ttl, Evt.currentTarget);
    }

    /*
      @ blog ID.
      @ bool to Random a blog. optional, defautl false.
      @ Title of blog frame. optional.
      @ the DOM object which Triggers JQuery Event. optional.
      @ Password of blog. optional. */
    function BlogOneFrame (ID, Rdm, Ttl, TrgDOM, Pswd) {
      if (typeof ID !== 'string' || ID.length === 0) { return -1; }

      Rdm = typeof Rdm === 'boolean' && Rdm ? 1 : 0;

      if (typeof Pswd !== 'string')   { Pswd = ''; }

      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: '/service/blog',
        data: { Id: ID, Rdm: Rdm, Pswd: Pswd},
        success: function (Data, TxtSt, JQXHR) {
          if (Data.Index < 0) {
            alert(Data.Index + ', ' + Data.Message);

            return -1;
          }
          else if (Data.Index > 0) {
            if (Data.Index > 1) { alert(Data.Message); }

            PasswordAsk(function (Pswd1) { BlogOneFrame(ID, Rdm, Ttl, TrgDOM, Pswd1); }, Ttl, TrgDOM);

            return -2;
          }

          let PswdFrm = $('#PswdFrm');

          if (PswdFrm.length > 0) { FrameHide(PswdFrm); }

          let TgtFrm = null;

          switch (Data.Extend.Tp) {
            case 'text':
              TgtFrm = OneTextShow(Data.Extend);
              break;

            case 'zft':
              TgtFrm = OneZftShow(Data.Extend);
              break;

            case 'image':
              TgtFrm = OneImageShow(Data.Extend);
              break;

            case 'images':
              TgtFrm = OneImagesShow(Data.Extend);
              break;

            default:
              alert('working on it.');
              return 0;
          }

          let FrmO = TgtFrm.get(0),
              ExBx = $('<span><input type="checkbox"/><span/></span>');

          FrmO.CommentCountSet = CommentCountSet;
          FrmO.CommentCountGet = CommentCountGet;

          ExBx.addClass('Ftr')
              .appendTo(TgtFrm)
              .children('input:checkbox').attr('title', '進階選項')
                                         .change(ExtraInfoToggle)
                                         .end()
              .children('span').css({'display': 'none'});

          //==== set time info. ====

         let TmBx = $('<div><span/><span></div>');

         TmBx.appendTo(ExBx.children('span:first'))
             .children('span').first().text('建立時間：')
                                      .end()
                              .last().text(Data.Extend.Dt);

         //==== set tags list. ====

          if (Data.Extend.Tgs.length > 0) {
            let TgBx = $('<div><span/><span/></div>');

            TgBx.appendTo(ExBx.children('span:first'))
                .children('span').first().text('標籤：');

            for (let i in Data.Extend.Tgs) {
              let Tg = Data.Extend.Tgs[i];

              $('<span/>').attr('name', Tg.ID)
                          .text(Tg.Nm)
                          .appendTo(TgBx.children('span:last'));
            }
          }

          //==== set share link URL. ====

          let ShrLnk = $('<div><span/><a/><a/><a/><a/><a/></div>'),
              URL = encodeURIComponent(Data.Extend.Url),
              Facebook = 'https://www.facebook.com/share.php?u=' + URL,
              GooglePlus = 'https://plus.google.com/share?url=' + URL,
              Twitter = 'https://twitter.com/intent/tweet?url=' + URL,
              Plurk = 'https://www.plurk.com/?qualifier=shares&status=' + URL + ' (' + Ttl +')'; // post to Plurk.

          ShrLnk.appendTo(ExBx.children('span:first'))
                .children('span:first').text('分享網址：')
                                       .end()
                .children('a').attr('target', '_blank')
                              .eq(0).addClass('IcoShr IcoLnk')
                                    .attr({'href': Data.Extend.Url, 'title': '直接連結'})
                                    .end()
                              .eq(1).addClass('IcoShr IcoFb')
                                    .attr({'href': Facebook, 'title': '分享至 Facebook'})
                                    .end()
                              .eq(2).addClass('IcoShr IcoGp')
                                    .attr({'href': GooglePlus, 'title': '分享至 Google+'})
                                    .end()
                              .eq(3).addClass('IcoShr IcoTtr')
                                    .attr({'href': Twitter, 'title': '分享至 Twitter'})
                                    .end()
                              .eq(4).addClass('IcoShr IcoPlk')
                                    .attr({'href': Plurk, 'title': '分享至 Plurk'});

          if (Data.Extend.Pswd.length > 0) {
            $('<span/>').addClass('IcoBlogTp IcoBlogLck')
                        .attr({'title': '上鎖的文章'})
                        .prependTo(ShrLnk);
          }

          //==== guest response. ====

          let RspBtn = $('<input type="button"/>');

          RspBtn.appendTo(ExBx.children('span:first'))
                .addClass('Btn0')
                .on('click', BlogCommentListFrame);

          if (typeof Data.Extend.CmtCnt !== 'undefined' && Data.Extend.CmtCnt > 0) {
            FrmO.CommentCountSet(parseInt(Data.Extend.CmtCnt, 10));
          }
          else { FrmO.CommentCountSet(0); }

          //====

          let FrmSz = [TgtFrm.width(), TgtFrm.height()],
              R = [0, 0];

          if (typeof TrgDOM === 'object' && TrgDOM !== null) {
            let TE = $(TrgDOM), // 'TE' = Target Element.
                TF = TE.closest('.Frm'); // 'TF' = Target Frame element.

            R = RelatedFrameRectangle(TF, FrmSz, [0, TE.offset().top - TF.offset().top]);
          }
          else { R = [Math.max(($(document).width() - FrmSz[0]) / 2, 0), 30]; }

          FrameShow(TgtFrm, R[0], R[1]);
        }
      });

      return 0;

      function OneTextShow (Data) {
        let Bx = $('<div><pre/></div>');

        Bx.addClass('Blog Text')
          .children(':first-child').html(TextToHTML(Data.Info));

        let Frm = Frame('#Main', 500 + 15, 400, function () { return Bx; }, 'Frm', Data.Ttl, true);

        return Frm.attr('id', 'Frm_' + Data.Id);
      }

      function OneZftShow (Data) {
        let Bx = $('<div><pre/></div>');

        Bx.addClass('Blog Text')
          .children(':first-child').html(Z.ZFT(Data.Info));

        let Frm = Frame('#Main', 500 + 15, 400, function () { return Bx; }, 'Frm', Data.Ttl, true);

        return Frm.attr('id', 'Frm_' + Data.Id);
      }

      function OneImageShow (Data) {
        let ImgSz = [400, 380],
            Bx = $('<div><img/><pre/><br/></div>');

        Bx.addClass('Blog Img')
          .children('img').attr({'src': Data.Info.ImgUrl, 'title': '縮圖/原圖切換'})
                          .css({'maxWidth': ImgSz[0], 'maxHeight': ImgSz[1]})
                          .on('click', [ImgSz[0], ImgSz[1]], ImageSizeSwitch)
                          .on('click', function () { $(this).closest('.Frm').find('> div:first > span:last > span:eq(2)').click(); })
                          .one('load', ContentPlace)
                          .end()
          .children('pre').html(TextToHTML(Data.Info.Str));

        let Frm = Frame('#Main', 500 + 15, 400, function () { return Bx; }, 'Frm', Data.Ttl, true);

        Frm.attr('id', 'Frm_' + Data.Id);

        return Frm;

        function ContentPlace (Evt) {
          let This = $(this);

          if (This.width() > This.height()) { This.after('<br/>'); }
        }
      }

      function OneImagesShow (Data) {
        let ImgSz = [400, 300],
            Bx = $('<div/>').addClass('Blog Imgs');

        for (let i in Data.Lst) {
          let V = Data.Lst[i],
              One = $('<div>' + '<img/>' + '<div><span>▲</span> <span/></div>' + '</div>');

          One.css({'minWidth': ImgSz[0]})
             .children('img').addClass('Unload')
                             .attr('src', V.TbnURL)
                             .data('TglSzURL', V.ImgURL)
                             .css({'maxWidth': ImgSz[0], 'maxHeight': ImgSz[1]})
                             .on('click', [ImgSz[0], ImgSz[1]], ImageSizeSwitch)
                             .on('load', function () { $(this).removeClass('Unload'); })
                             .end()
             .find('> div:first > span:eq(1)').css({'maxWidth': ImgSz[0] - 10})
                                              .html(TextToHTML(V.Str))
                                              .end()
             .appendTo(Bx);

          if (V.Str.length === 0) { One.find('> div > span:first').text(''); }
        }

        let Frm = Frame('#Main', 500 + 15, 400, function () { return Bx; }, 'Frm', Data.Ttl, true);

        Frm.attr('id', 'Frm_' + Data.Id);

        return Frm;
      }

      function ImageSizeSwitch (Evt) {
        Evt.stopPropagation();

        let This = $(Evt.currentTarget),
            Chk = [This.css('maxWidth'), This.css('maxHeight')],
            W = (Chk[0] === 'none' || Chk[0].length === 0) ? Evt.data[0] : '',
            H = (Chk[1] === 'none' || Chk[1].length === 0) ? Evt.data[1] : '',
            TglSzURL = This.data('TglSzURL');

        This.css({'maxWidth': W, 'maxHeight': H});

        if (typeof TglSzURL === 'string' && TglSzURL.length > 0) {
          let Src = This.attr('src');

          if (Src !== TglSzURL) {
            This.attr('src', TglSzURL)
                .data('TglSzURL', Src);
          }
        }
      }

      function PasswordAsk (ThenF, Ttl, TrgDOM) {
        if (typeof ThenF !== 'function') { return -1; }

        let ID = 'PswdFrm',
            Frm = $('#' + ID),
            PswdBx = $('#PswdBx'),
            TE = $(TrgDOM), // 'TE' = Triggered Element.
            TF = TE.closest('.Frm'), // 'TF' = Triggered Frame.
            R = null; // 'R' = Rectangle.

        if (Frm.length > 0) {
          R = RelatedFrameRectangle(TF, [Frm.width(), Frm.height()], [0, TE.offset().top - TF.offset().top]);
        }
        else {
          let Mn = $('#Main'); // 'Mn' = Main.

          Frm = Frame(Mn, 280, 100, function () { return PswdBx; }, 'Frm', '輸入密碼', true);

          Frm.attr({'id': ID})
             .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(Frm); });

          if (TE.length === 0 || TF.length === 0) { R = [(Mn.width() - Frm.outerWidth()) / 2, 30]; }
          else {
            R = RelatedFrameRectangle(TF, [Frm.width(), Frm.height()], [0, TE.offset().top - TF.offset().top]);
          }
        }

        Ttl = (typeof Ttl === 'string' && Ttl.length > 0) ? ('請輸入「' + Ttl + '」的密碼:') : '請輸入密碼:';

        let Pswd = PswdBx.find('> div:first > span.Block:first').text(Ttl)
                                                     .end()
                         .children('input:button:first').off('click')
                                                        .on('click', PasswordSubmit)
                                                        .end()
                         .children('input:password:first').off('keypress')
                                                          .on('keypress', KeyCodeFilter)
                                                          .val('');

        FrameShow(Frm, R[0], R[1]);
        setTimeout(function () { Pswd.focus(); }, 1000);

        return 0;

        function KeyCodeFilter (Evt) {
          if (Evt.keyCode !== 13) { return -1; }

          PasswordSubmit(Evt);
        }

        function PasswordSubmit (Evt) {
          let Pswd = $(Evt.currentTarget).siblings().addBack().filter('input:password:first').val();

          ThenF(Pswd);
        }
      }

      function ExtraInfoToggle (Evt) {
        $(Evt.currentTarget).next('span').toggle();
      }

      function CommentCountSet (Cnt) {
        let This = $(this),
            Btn = This.find('> span:last input:button:first');

        if (typeof Cnt !== 'number') { Cnt = 0; }

        if (Cnt > 0) { Btn.val('訪客回應 (' + Cnt.toString() + ')'); }
        else { Btn.val('訪客回應') }

        This.data('CmtCnt', Cnt);
      }

      function CommentCountGet () {
        let This = $(this),
            Cnt = This.data('CmtCnt');

        if (typeof Cnt === 'undefined') { Cnt = 0; }

        return Cnt;
      }
    }
  }

  function BlogCommentListFrame (Evt) {
    Evt.stopPropagation();

    let This = $(this),
        PF = This.closest('.Frm'), // 'PF' = Parent Frame.
        Ttl = PF.find('> div:first > span:first').text() + ' > 訪客留言',
        R = [], // 'R' = Rectangle.
        ID = PF.attr('id').replace('Frm_', ''),
        FrmID = 'BlogCmtLstFrm_' + ID,
        Frm = $('#' + FrmID);

    if (Frm.length > 0) {
      R = RelatedFrameRectangle(PF, [Frm.width(), Frm.height()]);

      FrameShow(Frm, R[0], R[1]);

      return 0;
    }

    Frm = Frame('#Main', 360, 320, BlogCommentListFrameSet, 'Frm', Ttl, true);
    R = RelatedFrameRectangle(PF, [Frm.width(), Frm.height()]);

    Frm.attr('id', FrmID);
    FrameShow(Frm, R[0], R[1]);

    return 0;

    function BlogCommentListFrameSet (Evt) {
      let Bx = $('#BlogCmtLstBx').clone().removeAttr('id').children(),
          LvBx = $('#LvBx').clone().removeAttr('id');

      Bx.last().children('input:button').on('click', CommentLeaveBoxToggle)
                                        .end()
               .append(LvBx)
               .children('div:last').css({'padding': 5, 'borderWidth': 1, 'borderRadius': 5})
                                    .hide()
                                    .find('input:button').on('click', BlogCommentLeave);

      if (typeof CO.GstNm === 'string') { // set cached guest name from cookie.
        Bx.last().find('input:text.Nm').val(CO.GstNm)
                                       .end()
                 .find('input:checkbox.RmbMe').prop('checked', true);
      }

      ItemList(Bx.first(), '/service/blog/commentlist', -1, { ID: ID }, OneBlogComment, []);

      return Bx;
    }

    function CommentLeaveBoxToggle (Evt) {
      let This = $(this),
          LvBx = This.next();

      if (LvBx.css('display') === 'none') {
        let Bx = This.parent().prev();

        This.val('取消留言');
        LvBx.show()
            .find('input:text:first').focus();
        Bx.parent().animate({'scrollTop': Bx.height()}, 0);
      }
      else {
        This.val('新留言');
        LvBx.hide();
      }
    }

    function BlogCommentLeave (Evt) {
      Evt.stopPropagation();

      let This = $(this),
          ID = This.closest('.Frm').attr('id').replace('BlogCmtLstFrm_', ''),
          InfoBx = This.parent(),
          MlJO = InfoBx.find('input:text.Ml'),
          CmtJO = InfoBx.find('textarea:first');

      let SndData = {
            TgtID: ID,
            Nm: InfoBx.find('input:text.Nm').val().trim(),
            Ml: MlJO.val().trim(),
            Cmt: CmtJO.val().trim() };

      let RmbMe = InfoBx.find('input:checkbox.RmbMe').prop('checked'),
          ChkStr = '';

      if (typeof SndData.TgtID !== 'string' || SndData.TgtID.length === 0) {
        alert('出錯了!!!');

        return -1;
      }

      if (SndData.Nm.length === 0) {
        SndData.Nm = '匿名';

        $('#Nm').val(SndData.Nm);
      }

      if (RmbMe) {// set cookie. 'GstNm' = Guest Name.
        CookieSet('GstNm', SndData.Nm, CO.LfTm);

        CO.GstNm = SndData.Nm;
      }
      else {
        CookieSet('GstNm', SndData.Nm, CO.LfTm * -1);

        CO.GstNm = '';
      }

      if (SndData.Ml.length === 0) { ChkStr += "尚未填寫 E-Mail。\n"; }
      else if (!Z.Is.EMail(SndData.Ml)) { ChkStr += "E-Mail 不符合標準格式。\n"; }

      if (SndData.Cmt.length === 0) { ChkStr += "尚未填寫任何留言。\n"; }
      else if (SndData.Cmt.length > 255) { ChkStr += "留言請勿超個 255 個字。\n"; }

      if (ChkStr.length > 0) {
        alert("請留意以下說明：\n" + ChkStr);

        return 0;
      }

      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: '/service/blog/commentleave',
        data: SndData,
        beforeSend: function (JQXHR, Set) { This.get(0).Lock(); },
        error : function (JQXHR, TxtSt, ErrThr) { alert('出錯了!!!'); },
        complete : function (JQXHR, TxtSt) { This.get(0).Unlock(); },
        success: function (Rtn, TxtSt, JQXHR) {
          if (Rtn.Index < 0) {
            alert(Rtn.Index + ', ' + Rtn.Message);

            return 0;
          }

          MlJO.add(CmtJO).val('');

          InfoBx.prev('input:button').click()
                                     .parent().prev().get(0).PageGet(0);

          let RF = $('#Frm_' + ID); // 'RF' = Related Frame.

          if (RF.length > 0) {
            let FO = RF.get(0);

            FO.CommentCountSet(FO.CommentCountGet() + 1);
          }
        }});
    }

    function OneBlogComment (Data, Idx) {
      let Bx = $('#OneMsgCmt').clone().removeAttr('id');

      Idx = parseInt(Idx, 10) + 1;

      Bx.children().first().text(Data.Nm)
                           .end()
                   .eq(1).html(TextToHTML(Data.Cmt))
                         .end()
                   .eq(2).text(Data.Dt)
                         .end()
                   .last().text('#' + Idx.toString());

      return Bx;
    }
  }

  /*
    Notice: this is a base frame. */
  function MessageListFrame (Ttl) {
    let ID = 'MsgBrdFrm',
        Frm = $('#' + ID),
        LstBx = $('#MsgLstBx'),
        Sz = [320, 520],
        BlgLstFrm = $('#BlgLstFrm'),
        TtlLstFrm = $('#TtlLstFrm');

    if (Frm.length > 0) {
      FrameShow(Frm);

      return 0;
    }

    Frm = Frame('#Main', Sz[0], Sz[1], MessageListFrameSet, 'Frm', Ttl, true);

    Frm.attr({'id': ID})
       .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(Frm); });

    FrameShow(Frm, BaseFrameXGet(Frm));

    return 0;

    function MessageListFrameSet () {
      ItemList(LstBx, '/service/message/list', 5, null, OneMessage, ['LstIdxTg', 'LstIdxTgDsb']);

      $('#NewMsgBtn').on('click', MessageLeaveFrame);
      $('#RldMsgLstBtn').on('click', MessageListReflash);
      LstBx.on('click', '.OneMsg > input:button:last-child', MessageChainListFrame);

      return LstBx.parent('div');
    }

    function OneMessage (Data, Idx) {
      let One = $('#OneMsg').clone().removeAttr('id');

      let ChnBtn = One.attr({'id': Data.ID})
                      .children().first().text(Data.Nm)
                                         .end()
                                 .eq(1).html(TextToHTML(Data.Msg))
                                       .end()
                                 .eq(2).text(Data.Dt)
                                       .end()
                                 .last(); // 'ChnBtn' = Chain Button.

      if (!isNaN(Data.ChnCnt) && Data.ChnCnt > 0) {
        ChnBtn.val(Data.ChnCnt)
              .show();
      }
      else {
        ChnBtn.val(ChnBtn.attr('title'));
        One.on({'mouseenter': function (Evt) { $(this).children('input:button:last').toggle(); },
                'mouseleave': function (Evt) { $(this).children('input:button:last').toggle(); }});
      }

      return One;
    }

    function MessageLeaveFrame (Evt) {
      Evt.stopPropagation();

      let ID = 'MsgLvFrm',
          Frm = $('#' + ID),
          This = $(this),
          RltFrm = This.closest('.Frm'),
          LvBx = null,
          R = null;

      if (Frm.length > 0) {
        LvBx = Frm.find('.LvBx');
        R = RelatedFrameRectangle(RltFrm, [Frm.width(), Frm.height()]);

        LvBx.children('input:text.Ml, textarea').val('');

        FrameShow(Frm, R[0], R[1]);
      }
      else {
        LvBx = $('#LvBx').clone().removeAttr('id');
        Frm = Frame('#Main', 360, 200, function () { return LvBx; }, 'Frm', '新留言', true);
        R = RelatedFrameRectangle(RltFrm, [Frm.width(), Frm.height()]);

        LvBx.children('input:button:last').on('click', MessageLeave);
        Frm.attr('id', ID)
           .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(Frm); });

        FrameShow(Frm, R[0], R[1]);
      }

      if (typeof CO.GstNm !== 'string' || CO.GstNm.length === 0) { // set cached guest name from cookie.
        LvBx.children('input:text:first').val('')
                                         .focus()
                                         .end()
            .find('> label > input:checkbox:first').prop('checked', false);
      }
      else {
        LvBx.children('input:text.Nm').val(CO.GstNm)
                                      .focus()
                                      .end()
            .find('> label > input:checkbox:first').prop('checked', true);
      }

      return 0;
    }

    function MessageListReflash () {
      let LstBxDOM = LstBx.get(0),
          MxLmt = parseInt($('#MxLmt').val(), 10);

      LstBxDOM.LimitSet(MxLmt);
      LstBxDOM.Recount(function () { LstBxDOM.PageGet(0); });
    }

    function MessageChainListFrame (Evt) {
      let This = $(Evt.currentTarget),
          HdMsg = This.parent(), // 'HdMsg' = Head Message.
          ID = HdMsg.attr('id'),
          Frm = $('#Msg_' + ID),
          Ttl = HdMsg.children('div:first').text() + ' 的留言串',
          PF = This.closest('.Frm'), // 'PF' = Parent Frame.
          R;

      if (Frm.length > 0) {
        R = RelatedFrameRectangle(PF, [Frm.width(), Frm.height()], [0, This.offset().top - PF.offset().top]);

        FrameShow(Frm, R[0], R[1]);

        return 0;
      }

      Frm = Frame('#Main', 360, 320, ChainFrameSet, 'Frm', Ttl, true);
      R = RelatedFrameRectangle(PF, [Frm.width(), Frm.height()], [0, This.offset().top - PF.offset().top]);

      Frm.attr('id', 'Msg_' + ID);

      FrameShow(Frm, R[0], R[1], function () { Frm.find('> div:first > span:last > span:eq(1)').click().click(); }); // 2 times 'click' is necessary.

      Frm.get(0).ChainReload = function () { Frm.find('.MsgChnBx > div:eq(1)').get(0).PageGet(0); };

      return 0;

      function ChainFrameSet () {
        let MsgChnBx = $('#MsgChnBx').clone().removeAttr('id'),
            LvBx = $('#LvBx').clone().removeAttr('id');

        MsgChnBx.children('div:first').replaceWith(HdMsg.clone().removeAttr('id'))
                                      .end()
                .children('div:first').children('input:button:last').remove()
                                                                    .end()
                                      .end()
                .children('div:last').append(LvBx)
                                     .children('input:button:first').on('click', MessageLeaveBoxToggle)
                                                                    .end()
                                     .children('div:first').hide()
                                                           .css({'padding': 5, 'borderWidth': 1, 'borderRadius': 5})
                                                           .children('input:button:last').on('click', MessageLeave);

        ItemList(MsgChnBx.children('div:eq(1)'), '/service/message/chainlist', -1, {'ID': ID}, OneChain, []);

        return MsgChnBx;
      }

      function MessageLeaveBoxToggle (Evt) {
        let This = $(this),
            LvBx = This.next('div');

        if (LvBx.css('display') === 'none') {
          let Bx = This.parent().parent();

          This.val('取消留言');
          LvBx.show()
              .children('input:text:first').focus();
          Bx.parent().animate({'scrollTop': Bx.height()}, 0);

          if (typeof CO.GstNm === 'string' && CO.GstNm.length > 0) {
            LvBx.children('input:text:first').val(CO.GstNm)
                                             .end()
                .find('> label:first > input:checkbox:first').prop('checked', true);
          }
        }
        else {
          This.val('新留言');
          LvBx.hide()
              .children('input:text').val('')
                                     .end()
              .children('textarea').val('');
        }
      }

      function OneChain (Data, Idx) {
        let One = $('#OneMsgCmt').clone().removeAttr('id');

        Idx = parseInt(Idx, 10) + 1;

        One.attr({'id': Data.ID})
           .children().first().text(Data.Nm)
                              .end()
                      .eq(1).html(TextToHTML(Data.Msg))
                            .end()
                      .eq(2).text(Data.Dt)
                            .end()
                      .eq(3).text('#' + Idx.toString());

        return One;
      }
    }

    function MessageLeave (Evt) {
      let This = $(this),
          TgtID = This.closest('.Frm').attr('id').replace(/^Msg_|^MsgLvFrm/, '');

      let SndData = {
            Nm: This.prevAll('input:text.Nm:first').val().trim(),
            Ml: This.prevAll('input:text.Ml:first').val().trim(),
            Msg: This.prevAll('textarea.Msg:first').val().trim()
          };

      let RmbMe = This.prev('label').children('input:checkbox').prop('checked'),
          ChkStr = '';

      if (SndData.Nm.length === 0) { SndData.Nm = '匿名'; }

      if (RmbMe) { // set cookie. 'GstNm' = Guest Name.
        CookieSet('GstNm', SndData.Nm, CO.LfTm);
        CO.GstNm = SndData.Nm;
      }
      else {
        CookieSet('GstNm', SndData.Nm, CO.LfTm * -1);
        CO.GstNm = '';
      }

      if (SndData.Ml.length === 0) { ChkStr += "尚未填寫 E-Mail。\n"; }
      else if (!Z.Is.EMail(SndData.Ml)) { ChkStr += "E-Mail 不符合標準格式。\n"; }

      if (SndData.Msg.length === 0) { ChkStr += "尚未填寫任何留言。\n"; }
      else if (SndData.Msg.length > 255) { ChkStr += "留言請勿超個 255 個字。\n"; }

      if (ChkStr.length > 0) {
        alert("請留意以下說明：\n" + ChkStr);

        return 0;
      }

      if (typeof TgtID === 'string' && TgtID.length > 0) { SndData.Tgt = TgtID; }

      $.ajax({
        type: 'POST',
        dataType: 'json',
        timeout : 20000,
        url: '/service/message/leave',
        data: SndData,
        beforeSend: function (JQXHR, Set) { This.get(0).Lock(); },
        error : function (JQXHR, TxtSt, ErrThr) { alert('出錯了!!!'); },
        complete : function (JQXHR, TxtSt) { This.get(0).Unlock(); },
        success: function (Rtn, TxtSt, JQXHR) {
          if (Rtn.Index < 0) {
            alert(Rtn.Index + ', ' + Rtn.Message);

            return 0;
          }

          let ChnFrm = $('#Msg_' + TgtID);

          if (ChnFrm.length > 0) { ChnFrm.get(0).ChainReload(); }

          This.parent().prev('input:button').click();
          $('#RldMsgLstBtn').click();
          FrameHide($('#MsgLvFrm'));
        }});
    }
  }

  function CustomFrame (Ttl) {
    let ID = 'CstURLFrm',
        Frm = $('#' + ID),
        Sz = [320, 100];

    if (Frm.length > 0) {
      FrameShow(Frm, null, null, function () { Frm.find('> div:eq(1) > input:text:first').focus(); });

      return 0;
    }

    Frm = Frame('#Main', Sz[0], Sz[1], CustomURLFrameSet, 'Frm', Ttl, true);

    Frm.attr({'id': ID})
       .get(0).ActionExtend('CloseButtonClick', function (FrmDOM) { FrameHide(Frm); });

    let Bs = $('#Main');
    let Txt = Frm.children('div:eq(1)').css('textAlign', 'center')
                                       .children('input:text:first');

    FrameShow(Frm, (Bs.width() - Frm.outerWidth()) / 2, Bs.offset().top + 5, function () { Txt.focus(); });

    return 0;

    function CustomURLFrameSet () {
      let Ctn = $('<input type="text"/><br/><span/><br/><input type="button"/>');

      Ctn.filter('span:first').text('(部分網站會禁止其它網站的內嵌引用。)')
                              .css('color', '#ff0000')
                              .end()
         .filter('input').css('marginTop', 10)
                         .filter(':text:first').on('keypress', KeyboardTrigger)
                                               .end()
                         .filter(':button:first').val('確定')
                                                 .addClass('Btn0')
                                                 .on('click', OneCustomFrame);

      return Ctn;
    }

    function KeyboardTrigger (Evt) {
      if (Evt.keyCode === 13) { $(this).nextAll('input:button:first').click(); }
    }

    function OneCustomFrame (Evt) {
      let OneSz = [640, 480],
          URL = $(this).prevAll('input:text').val();

      if (URL.length === 0) { return 0; }

      let URLHd = URL.substr(0, 7);

      if (URLHd !== 'http://' && URLHd !== 'https:/') { URL = 'http://' + URL; }

      FrameHide(Frm);

      let Bs = $('#Main'),
          CstFrm = Frame('#Main', OneSz[0], OneSz[1], OneCustomFrameSet, 'Frm', URL, true);

      CstFrm.get(0).ActionExtend('SizeChange', OneCustomFrameResize);

      FrameShow(CstFrm, (Bs.width() - CstFrm.outerWidth()) / 2, Bs.offset().top + 5);

      return 0;

      function OneCustomFrameSet () {
        let Bx = $('<iframe/>');

        Bx.attr('src', URL)
          .css({'width': OneSz[0], 'height': OneSz[1], 'border': '0px'});

        return Bx;
      }

      function OneCustomFrameResize (FrmDOM) {
        let Bx = CstFrm.children('div:eq(1)');

        Bx.children('iframe').width(Bx.width())
                             .height(Bx.height());
      }
    }
  }
</script>
<div id='Template'> <!-- Template -->
  <div id='LvBx' class='LvBx' style='text-align: center;'>
    <span class='TextTitle'>暱稱</span>
    <input type='text' class='Nm' placeholder='請輸入大名。' style='width: 250px;'/><br/>
    <span class='TextTitle'>E-Mail</span>
    <input type='text' class='Ml' placeholder='請輸入 E-Mail。(不會公開)' style='width: 250px;'/><br/>
    <span class='TextTitle'>留言</span>
    <textarea class='Msg' placeholder='請輸入訊息。' style='width: 250px; height: 70px; vertical-align: middle;'></textarea><br/>
    <label style='vertical-align: middle;' title='記住我的暱稱'>記住我<input type='checkbox' class='RmbMe' tabindex='-1'/></label>
    <input type='button' class='Btn0' style='margin-left: 20px; vertical-align: middle;' value='新留言'/>
  </div>
  <div>
    <div style='text-align: right;'>
      一頁 <input type='text' id='MxLmt' maxlength='2' value='5' autocomplete='off' placeholder='數字' style='width: 30px; text-align: center;'/> 筆
      <input type='button' id='RldMsgLstBtn' class='Btn0' value='更新列表'/>
      <input type='button' id='NewMsgBtn' class='Btn0' value='新留言'/>
    </div>
    <div id='MsgLstBx'></div>
  </div>
  <div>
    <div style='text-align: right;'>
      <input type='button' class='Btn0' value='標籤過濾'/>
      <input type='button' class='Btn0' value='隨機一篇'/>
    </div>
    <div id='BlogLstBx'></div>
  </div>
  <div id='OneMsg' class='OneMsg OneItm'>
    <div></div>
    <pre>...</pre>
    <div></div>
    <input type='button' class='Btn0' value='0' title='接著說'/>
  </div>
  <div id='OneBlog' class='OneBlog OneItm ClickItem'>
    <div></div>
    <div></div>
    <div></div>
    <div><span></span></div>
  </div>
  <div id='OneMsgCmt' class='OneMsgCmt OneItm'>
    <div></div>
    <pre></pre>
    <div></div>
    <span></span>
  </div>
  <div id='MsgChnBx' class='MsgChnBx'>
    <div></div>
    <div style='padding-left: 20px; overflow-y: auto;'></div>
    <div style='padding: 5px 0px; text-align: center;'>
      <input type='button' class='Btn0' value='新留言'/>
    </div>
  </div>
  <div id='BlogCmtLstBx'>
    <div></div>
    <div style='margin: 20px 0px 5px 0px; text-align: center;'>
      <input type='button' class='Btn0' value='新留言'/>
    </div>
  </div>
  <div id='PswdBx' style='text-align: center;'>
    <div style='margin: 5px 0px; text-align: center;'>
      <span class='Block' style='text-align: left;'></span>
    </div>
    <input type='password' placeholder='請輸入密碼' style='margin: 5px 0px;'/><br/>
    <input type='button' class='Btn0' value='確定'/>
  </div>
  <div id='AbtBx' class='TbBx'>
    <div class='AbtPg' name='網站導覽'>
      <b>關於</b>
      一些跟 空域有關的說明會盡量集中在這裡。

      <b>網誌</b>
      RZ 不定期分享的自言自語、碎碎唸等沒營養垃圾文章。

      <b>留言板</b>
      開放給客倌隨意留言，沒什麼限制，就是請大家多注意網路禮儀哦。

      <b>內嵌網頁</b>
      如果覺得 空域一格一格的瀏覽方式深得你心，
      想用這種方式去瀏覽其它空域以外的網頁，可以用這個方式把別人的網頁拉進來。

      <b>訂閱</b>
      想要隨時知道 RZ 是不是又在網誌上的發佈了垃圾文章，
      就用這個 RSS/Atom 訂閱 空域的最新消息吧。

      <b>回入口</b>
      回到 空域的大門口。RZ 除了網誌以外，還有其它比較主題性的資訊會擺在門口。
    </div>
    <div class='AbtPg' name='關於空域'>
      空域 是 RZ(小弟本人) 一腳踏進程式與資訊圈以來，不斷學習、探索，
      終於下定決心所成立的網站。

      開始構思發想階段的時間點已不可考；
      網站的成立時間則大約是在 2011 年 6 月前後。

      一開始發想很單純，
      RZ 不太滿意各 Blog 經營業者所提供的維護方式，即模版式的介面配置。
      可能是因為 RZ 自己喜歡凡是自己動手做，又剛好懂點網頁程式，
      因此萌生了一個吃力不討好的想法：
      「既然我可以自己做，幹嘛要屈就於人家 Blog 式的管理方式。」
      於是…可以算是價值觀扭曲、過度偏執的想法，成就了 空域 的開站。

      RZ 把 空域 當成個人生活的紀錄，基本上就是 Blog，
      但希望能跳脫制式 Blog 的版面框架；
      同時 RZ 也把 空域 當作在網頁程式精進的管道，
      在這裡，客倌無須拘慬，無論您是偶然經過，或是在此流連，
      若 空域 帶給您一些想法、一些啟發，不妨在 空域 留下您的心得。

      網海茫茫，人與人的際會如此奇妙…

      我的天空，我在其中，在我這裡，自由放空。 RZ 的個人網站。

      20120401 by RZ
    </div>
    <div class='AbtPg' name='關於我'>
      小弟本名 方元利，在成長的不同時期有不同的暱稱，基本上都跟名字發音有關，
      阿利、Lee、小方、RZ (目前較常使用) 等，
      RZ 不在乎客倌如何稱呼 RZ，名字不重要，重要的是所代表的人。

      有一陣子 RZ 用「天空」作為自己在網路上的代稱，
      因為喜歡天空的開闊，天空的湛藍。
      而本站名為 空域 ，也是由此而來。

      RZ 喜歡寫寫東西、畫畫東西，發發夢想，在 空域 裡客倌會發現這些習性，
      當然 RZ 也還喜歡很多事情，但嘮嘮不休不是 RZ 的習慣，
      客倌就隨意參觀吧。

      那麼…
      客倌，您好，
      我是 RZ ，
      初次見面的，請多指教；
      朋友，又見面了，歡迎回來。

      20120401 by RZ
    </div>
  </div>
  <div id='TgLstBx'>
    <div></div>
    <div style='margin-top: 10px;'>
      <input type='button' class='Btn0' value='不過濾'/>
      <input type='button' class='Btn0' value='確定'/>
    </div>
  </div>
</div>
<div id='Base'> <!-- Base -->
  <header id='Head'> <!-- Head -->
    <div>
      <button class='Btn0' title='關於' onclick='AboutFrame("關於");'>關於</button>
      <button class='Btn0' title='網誌' onclick='BlogListFrame("網誌列表");'>網誌</button>
      <button class='Btn0' title='留言板' onclick='MessageListFrame("留言列表");'>留言板</button>
      <button class='Btn0' title='內嵌網頁' onclick='CustomFrame("輸入網址");'>內嵌網頁</button>
      <a href='/feed.xml'><button class='Btn0' title='訂閱'>訂閱</button></a>
      <a href='/'><button class='Btn0' title='回入口'>回入口</button></a>
    </div>
  </header>
  <div id='Main'> <!-- Main -->
    <div id='AtCnr'>
      <pre class='Block'></pre>
    </div>
    <canvas id='GdWds'></canvas>
    <span id='AtCnrChk' class='Block'>角落藝廊</span>
    <span id='GdWdsChk'>佳言錄</span>
  </div>
  <footer id='Tail'> <!-- Tail -->
    ©2011-2019 RZ Fang
  </footer>
</div>
