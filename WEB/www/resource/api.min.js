"use strict";function FrameShow(Frm,X,Y,ThenF){if("object"!=typeof Frm)return 0;if(X="number"!=typeof X?Frm.css("left"):X,Y="number"!=typeof Y?Frm.css("top"):Y,"function"!=typeof ThenF&&(ThenF=function(){}),Frm.get(0).ToFront(),"none"!==Frm.css("display"))return Frm.animate({left:X,top:Y}),0;var Rdm=Math.round(3*Math.random());switch(Frm.css({left:X,top:Y}),Rdm){case 1:Frm.slideDown("normal",ThenF);break;case 2:Frm.fadeIn("normal",ThenF);break;case 0:default:Frm.show("normal",ThenF)}}function FrameHide(Frm){var Rdm=Math.round(3*Math.random());switch(Rdm){case 1:Frm.slideUp("normal");break;case 2:Frm.fadeOut("normal");break;case 0:default:Frm.hide("normal")}}function RelatedFrameRectangle(OrgFrm,TgtSz,OfstLct){if("object"!=typeof OrgFrm||"object"!=typeof TgtSz)return 0;("object"!=typeof OfstLct||OfstLct.length<2)&&(OfstLct=[0,0]);var C=$("#Main"),CL=C.offset(),CR=[CL.left,CL.top,C.innerWidth(),C.innerHeight()],OFL=OrgFrm.offset(),OR=[OFL.left,OFL.top,OrgFrm.innerWidth(),OrgFrm.innerHeight()],TR=[OR[0]+OR[2]+OfstLct[0]+5,OR[1]+OfstLct[1],TgtSz[0],TgtSz[1]];return TR[0]+TR[2]>CR[2]+CR[0]&&(TR[0]=OR[0]-TR[2]-5+CR[0]+OfstLct[0]),TR[0]<CR[0]&&(TR[0]=CR[0]+OfstLct[0]),TR[1]+TR[3]>CR[3]+CR[1]&&(TR[1]=CR[3]-TR[3]+CR[1]-5),TR[1]<CR[1]&&(TR[1]=CR[1]+5),TR}function BaseFrameXGet(Self){if("object"!=typeof Self)return 0;for(var BsFrmA=[$("#BlgLstFrm"),$("#MsgBrdFrm"),$("#TtlLstFrm")],MaxX=0,MinX=99999,i=0;i<BsFrmA.length;i++)if(void 0!==BsFrmA[i]&&0!==BsFrmA[i].length&&Self.attr("id")!==BsFrmA[i].attr("id")&&"none"!==BsFrmA[i].css("display")){var ChkXY=BsFrmA[i].offset();MaxX=Math.max(MaxX,ChkXY.left+BsFrmA[i].width()+5),MinX=Math.min(MinX,ChkXY.left-5)}99999===MinX&&(MinX=0);var SelfW=Self.width();return MinX>SelfW?MinX-SelfW:MaxX}function AboutFrame(Ttl){function AboutFrameSet(){return TabBox("#AbtBx","#AbtBx > div.AbtPg",0)}var ID="ItdFrm",Frm=$("#"+ID);if(Frm.length>0)return FrameShow(Frm),0;Frm=Frame("#Main",640,480,AboutFrameSet,"Frm",Ttl,!0),Frm.attr({id:ID}).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)});var Bs=$("#Main");return FrameShow(Frm,(Bs.width()-Frm.outerWidth())/2,Bs.offset().top+5),0}function BlogListFrame(Ttl){function BlogListFrameSet(){var LstBx=$("#BlogLstBx"),BlogBx=LstBx.parent(),OptnBtn=BlogBx.find("> div:first > input:button");return ItemList(LstBx,"service.php",5,{Cmd:1},OneBlog,["LstIdxTg","LstIdxTgDsb"]),OptnBtn.first().on("click",TagListFrame).end().eq(1).on("click",OneRandomBlogShow),LstBx.on("click",".OneBlog",OneBlogShow),BlogBx}function OneBlog(Data){var Itm=$("#OneBlog").clone().removeAttr("id");if(Itm.attr("id",Data.ID).data("Pswd",Data.Pswd).children("div:first").text(Data.Ttl).end().children("div:eq(2)").text(Data.Smry).end().find("> div:last > span:last").text(Data.Dt.substr(0,10)),"object"==typeof Data.Tg&&Data.Tg.length>0)for(var i in Data.Tg){var Tg=Data.Tg[i];$("<span/>").text(Tg.Nm).attr("name",Tg.ID).appendTo(Itm.children("div:eq(1)"))}if(Data.Pswd.length>0){var LckIco=$("<span/>");LckIco.addClass("IcoBlogTp IcoBlogLck").attr({title:"上鎖的文章"}).prependTo(Itm.find("> div:last > span:last"))}switch(Data.Tp){case"text":$("<span/>").addClass("IcoBlogTp IcoBlogTxt").attr({title:"文章"}).prependTo(Itm.find("> div:last > span:last"));break;case"image":$("<span/>").addClass("IcoBlogTp IcoBlogImg").attr({title:"圖文"}).prependTo(Itm.find("> div:last > span:last"));break;case"images":$("<span/>").addClass("IcoBlogTp IcoBlogImgs").attr({title:"相簿"}).prependTo(Itm.find("> div:last > span:last"))}return Itm}function OneRandomBlogShow(Evt){Evt.stopPropagation(),$(Evt.currentTarget).attr({id:"00000000000000000000000000000000",name:"random"}),OneBlogShow(Evt)}function TagListFrame(Evt){function NoTagFilterList(Evt){Evt.stopPropagation(),$(this).closest("div").prev("div").find("input:checkbox").prop("checked",!1),ItemList("#BlogLstBx","service.php",5,{Cmd:1,TgIDA:[]},OneBlog,["LstIdxTg","LstIdxTgDsb"]),FrameHide(Frm)}function TagFilterList(Evt){Evt.stopPropagation();var TgIDA=[];$(this).closest("div").prev("div").find("input:checkbox:checked").each(function(){TgIDA.push($(this).val())}),ItemList("#BlogLstBx","service.php",5,{Cmd:1,TgIDA:TgIDA},OneBlog,["LstIdxTg","LstIdxTgDsb"]),FrameHide(Frm)}Evt.stopPropagation();var ID="TgLstFrm",Frm=$("#"+ID),R=[0,0];return"object"==typeof Frm&&Frm.length>0?(R=RelatedFrameRectangle(BlogLstFrm,[Frm.outerWidth(),Frm.outerHeight()]),FrameShow(Frm,R[0],R[1]),1):($.ajax({type:"POST",dataType:"json",timeout:2e4,url:"service.php",data:{Cmd:7},success:function(Rtn){if(Rtn.Index<0)return alert(Rtn.Message),-1;var Bx=$("#TgLstBx").children(),Lst=Bx.first(),Tlt=$('<div><label><input type="checkbox"/><span/></lable></div>');for(var i in Rtn.Extend){var Info=Rtn.Extend[i],One=Tlt.clone().addClass("OneTg").appendTo(Lst);One.children("label").children("input:checkbox").val(Info.ID).end().children("span").addClass("Block").text(Info.Nm)}Bx.eq(1).children("input:button").first().on("click",NoTagFilterList).end().eq(1).on("click",TagFilterList),Frm=Frame("#Main",200,200,function(){return Bx},"Frm","標籤過濾",!0),Frm.attr("id",ID).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)}),R=RelatedFrameRectangle(BlogLstFrm,[Frm.outerWidth(),Frm.outerHeight()]),FrameShow(Frm,R[0],R[1])}}),0)}function OneBlogShow(Evt){Evt.stopPropagation();var This=$(Evt.currentTarget),ID=This.attr("id"),Ttl=This.children("div:first").text(),Rdm=(This.data("Pswd"),"random"===This.attr("name"));if(0===ID.length)return-1;var Frm=$("#Frm_"+ID);if(Frm.length>0){var PF=This.closest(".Frm"),R=RelatedFrameRectangle(PF,[Frm.width(),Frm.height()],[0,This.offset().top-PF.offset().top]);return FrameShow(Frm,R[0],R[1]),1}BlogOneFrame(ID,Rdm,Ttl,Evt.currentTarget)}{var ID="BlgLstFrm",BlogLstFrm=$("#"+ID),Sz=[280,520];$("#MsgBrdFrm")}return BlogLstFrm.length>0?(FrameShow(BlogLstFrm),0):(BlogLstFrm=Frame("#Main",Sz[0],Sz[1],BlogListFrameSet,"Frm",Ttl,!0),BlogLstFrm.attr({id:ID}).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(BlogLstFrm)}),FrameShow(BlogLstFrm,BaseFrameXGet(BlogLstFrm)),0)}function BlogOneFrame(ID,Rdm,Ttl,TrgDOM,Pswd){function OneTextShow(Data){var Bx=$("<div><pre/></div>");Bx.addClass("Blog Text").children(":first-child").html(TextToHTML(Data.Info.Str));var Frm=Frame("#Main",515,400,function(){return Bx},"Frm",Data.Ttl,!0);return Frm.attr("id","Frm_"+Data.ID)}function OneImageShow(Data){function ContentPlace(){var This=$(this);This.width()>This.height()&&This.after("<br/>")}var ImgSz=[400,380],Bx=$("<div><img/><pre/><br/></div>");Bx.addClass("Blog Img").children("img").attr({src:Data.Info.ImgURL,title:"縮圖/原圖切換"}).css({maxWidth:ImgSz[0],maxHeight:ImgSz[1]}).on("click",[ImgSz[0],ImgSz[1]],ImageSizeSwitch).on("click",function(){$(this).closest(".Frm").find("> div:first > span:last > span:eq(2)").click()}).one("load",ContentPlace).end().children("pre").html(TextToHTML(Data.Info.Str));var Frm=Frame("#Main",515,400,function(){return Bx},"Frm",Data.Ttl,!0);return Frm.attr("id","Frm_"+Data.ID),Frm}function OneImagesShow(Data){var ImgSz=[400,300],Bx=$("<div/>").addClass("Blog Imgs");for(var i in Data.Lst){var V=Data.Lst[i],One=$("<div><img/><div><span>▲</span> <span/></div></div>");One.css({minWidth:ImgSz[0]}).children("img").addClass("Unload").attr("src",V.TbnURL).data("TglSzURL",V.ImgURL).css({maxWidth:ImgSz[0],maxHeight:ImgSz[1]}).on("click",[ImgSz[0],ImgSz[1]],ImageSizeSwitch).on("load",function(){$(this).removeClass("Unload")}).end().find("> div:first > span:eq(1)").css({maxWidth:ImgSz[0]-10}).html(TextToHTML(V.Str)).end().appendTo(Bx),0===V.Str.length&&One.find("> div > span:first").text("")}var Frm=Frame("#Main",515,400,function(){return Bx},"Frm",Data.Ttl,!0);return Frm.attr("id","Frm_"+Data.ID),Frm}function ImageSizeSwitch(Evt){Evt.stopPropagation();var This=$(Evt.currentTarget),Chk=[This.css("maxWidth"),This.css("maxHeight")],W="none"===Chk[0]||0===Chk[0].length?Evt.data[0]:"",H="none"===Chk[1]||0===Chk[1].length?Evt.data[1]:"",TglSzURL=This.data("TglSzURL");if(This.css({maxWidth:W,maxHeight:H}),"string"==typeof TglSzURL&&TglSzURL.length>0){var Src=This.attr("src");Src!==TglSzURL&&This.attr("src",TglSzURL).data("TglSzURL",Src)}}function PasswordAsk(ThenF,Ttl,TrgDOM){function KeyCodeFilter(Evt){return 13!==Evt.keyCode?-1:void PasswordSubmit(Evt)}function PasswordSubmit(Evt){var Pswd=$(Evt.currentTarget).siblings().addBack().filter("input:password:first").val();ThenF(Pswd)}if("function"!=typeof ThenF)return-1;var ID="PswdFrm",Frm=$("#"+ID),PswdBx=$("#PswdBx"),TE=$(TrgDOM),TF=TE.closest(".Frm"),R=null;if(Frm.length>0)R=RelatedFrameRectangle(TF,[Frm.width(),Frm.height()],[0,TE.offset().top-TF.offset().top]);else{var Mn=$("#Main");Frm=Frame(Mn,280,100,function(){return PswdBx},"Frm","輸入密碼",!0),Frm.attr({id:ID}).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)}),R=0===TE.length||0===TF.length?[(Mn.width()-Frm.outerWidth())/2,30]:RelatedFrameRectangle(TF,[Frm.width(),Frm.height()],[0,TE.offset().top-TF.offset().top])}Ttl="string"==typeof Ttl&&Ttl.length>0?"請輸入「"+Ttl+"」的密碼:":"請輸入密碼:";var Pswd=PswdBx.find("> div:first > span.Block:first").text(Ttl).end().children("input:button:first").off("click").on("click",PasswordSubmit).end().children("input:password:first").off("keypress").on("keypress",KeyCodeFilter).val("");return FrameShow(Frm,R[0],R[1]),setTimeout(function(){Pswd.focus()},1e3),0}function ExtraInfoToggle(Evt){$(Evt.currentTarget).next("span").toggle()}function CommentCountSet(Cnt){var This=$(this),Btn=This.find("> span:last input:button:first");"number"!=typeof Cnt&&(Cnt=0),Btn.val(Cnt>0?"訪客回應 ("+Cnt.toString()+")":"訪客回應"),This.data("CmtCnt",Cnt)}function CommentCountGet(){var This=$(this),Cnt=This.data("CmtCnt");return"undefined"==typeof Cnt&&(Cnt=0),Cnt}return"string"!=typeof ID||0===ID.length?-1:(Rdm="boolean"==typeof Rdm&&Rdm?1:0,"string"!=typeof Pswd&&(Pswd=""),$.ajax({type:"POST",dataType:"json",timeout:2e4,url:"service.php",data:{Cmd:2,ID:ID,Rdm:Rdm,Pswd:Pswd},success:function(Data){if(Data.Index<0)return alert(Data.Index+", "+Data.Message),-1;if(Data.Index>0)return Data.Index>1&&alert(Data.Message),PasswordAsk(function(Pswd1){BlogOneFrame(ID,Rdm,Ttl,TrgDOM,Pswd1)},Ttl,TrgDOM),-2;var PswdFrm=$("#PswdFrm");PswdFrm.length>0&&FrameHide(PswdFrm);var TgtFrm=null;switch(Data.Extend.Tp){case"text":TgtFrm=OneTextShow(Data.Extend);break;case"image":TgtFrm=OneImageShow(Data.Extend);break;case"images":TgtFrm=OneImagesShow(Data.Extend);break;default:return alert("working on it."),0}var FrmO=TgtFrm.get(0),ExBx=$('<span><input type="checkbox"/><span/></span>');FrmO.CommentCountSet=CommentCountSet,FrmO.CommentCountGet=CommentCountGet,ExBx.addClass("Ftr").appendTo(TgtFrm).children("input:checkbox").attr("title","進階選項").change(ExtraInfoToggle).end().children("span").css({display:"none"});var TmBx=$("<div><span/><span></div>");if(TmBx.appendTo(ExBx.children("span:first")).children("span").first().text("建立時間：").end().last().text(Data.Extend.Dt),Data.Extend.TgA.length>0){var TgBx=$("<div><span/><span/></div>");TgBx.appendTo(ExBx.children("span:first")).children("span").first().text("標籤：");for(var i in Data.Extend.TgA){var Tg=Data.Extend.TgA[i];$("<span/>").attr("name",Tg.ID).text(Tg.Nm).appendTo(TgBx.children("span:last"))}}var ShrLnk=$("<div><span/><a/><a/><a/><a/><a/></div>"),URL=encodeURIComponent(Data.Extend.URL),Facebook="http://www.facebook.com/share.php?u="+URL,GooglePlus="https://plus.google.com/share?url="+URL,Twitter="http://twitter.com/intent/tweet?url="+URL,Plurk="http://www.plurk.com/?qualifier=shares&status="+URL+" ("+Ttl+")";ShrLnk.appendTo(ExBx.children("span:first")).children("span:first").text("分享網址：").end().children("a").attr("target","_blank").eq(0).addClass("IcoShr IcoLnk").attr({href:Data.Extend.URL,title:"直接連結"}).end().eq(1).addClass("IcoShr IcoFb").attr({href:Facebook,title:"分享至 Facebook"}).end().eq(2).addClass("IcoShr IcoGp").attr({href:GooglePlus,title:"分享至 Google+"}).end().eq(3).addClass("IcoShr IcoTtr").attr({href:Twitter,title:"分享至 Twitter"}).end().eq(4).addClass("IcoShr IcoPlk").attr({href:Plurk,title:"分享至 Plurk"}),Data.Extend.Pswd.length>0&&$("<span/>").addClass("IcoBlogTp IcoBlogLck").attr({title:"上鎖的文章"}).prependTo(ShrLnk);var RspBtn=$('<input type="button"/>');RspBtn.appendTo(ExBx.children("span:first")).addClass("Btn0").on("click",BlogCommentListFrame),FrmO.CommentCountSet("undefined"!=typeof Data.Extend.CmtCnt&&Data.Extend.CmtCnt>0?parseInt(Data.Extend.CmtCnt,10):0);var FrmSz=[TgtFrm.width(),TgtFrm.height()],R=[0,0];if("object"==typeof TrgDOM&&null!==TrgDOM){var TE=$(TrgDOM),TF=TE.closest(".Frm");R=RelatedFrameRectangle(TF,FrmSz,[0,TE.offset().top-TF.offset().top])}else R=[Math.max(($(document).width()-FrmSz[0])/2,0),30];FrameShow(TgtFrm,R[0],R[1])}}),0)}function BlogCommentListFrame(Evt){function BlogCommentListFrameSet(){var Bx=$("#BlogCmtLstBx").clone().removeAttr("id").children(),LvBx=$("#LvBx").clone().removeAttr("id");return Bx.last().children("input:button").on("click",CommentLeaveBoxToggle).end().append(LvBx).children("div:last").css({padding:5,borderWidth:1,borderRadius:5}).hide().find("input:button").on("click",BlogCommentLeave),"string"==typeof CO.GstNm&&Bx.last().find("input:text.Nm").val(CO.GstNm).end().find("input:checkbox.RmbMe").prop("checked",!0),ItemList(Bx.first(),"service.php",-1,{Cmd:8,ID:ID},OneBlogComment,[]),Bx}function CommentLeaveBoxToggle(){var This=$(this),LvBx=This.next();if("none"===LvBx.css("display")){var Bx=This.parent().prev();This.val("取消留言"),LvBx.show().find("input:text:first").focus(),Bx.parent().animate({scrollTop:Bx.height()},0)}else This.val("新留言"),LvBx.hide()}function BlogCommentLeave(Evt){Evt.stopPropagation();var This=$(this),ID=This.closest(".Frm").attr("id").replace("BlogCmtLstFrm_",""),InfoBx=This.parent(),MlJO=InfoBx.find("input:text.Ml"),CmtJO=InfoBx.find("textarea:first"),SndData={Cmd:9,TgtID:ID,Nm:Trim(InfoBx.find("input:text.Nm").val()),Ml:Trim(MlJO.val()),Cmt:Trim(CmtJO.val())},RmbMe=InfoBx.find("input:checkbox.RmbMe").prop("checked"),ChkStr="";return"string"!=typeof SndData.TgtID||0===SndData.TgtID.length?(alert("出錯了!!!"),-1):(0===SndData.Nm.length&&(SndData.Nm="匿名",$("#Nm").val(SndData.Nm)),RmbMe?(CookieSet("GstNm",SndData.Nm,CO.LfTm),CO.GstNm=SndData.Nm):(CookieSet("GstNm",SndData.Nm,-1*CO.LfTm),CO.GstNm=""),0===SndData.Ml.length?ChkStr+="尚未填寫 E-Mail。\n":IsEMail(SndData.Ml)||(ChkStr+="E-Mail 不符合標準格式。\n"),0===SndData.Cmt.length?ChkStr+="尚未填寫任何留言。\n":SndData.Cmt.length>255&&(ChkStr+="留言請勿超個 255 個字。\n"),ChkStr.length>0?(alert("請留意以下說明：\n"+ChkStr),0):void $.ajax({type:"POST",dataType:"json",timeout:2e4,url:"service.php",data:SndData,beforeSend:function(){This.get(0).Lock()},error:function(){alert("出錯了!!!")},complete:function(){This.get(0).Unlock()},success:function(Rtn){if(Rtn.Index<0)return alert(Rtn.Index+", "+Rtn.Message),0;MlJO.add(CmtJO).val(""),InfoBx.prev("input:button").click().parent().prev().get(0).PageGet(0);var RF=$("#Frm_"+ID);if(RF.length>0){var FO=RF.get(0);FO.CommentCountSet(FO.CommentCountGet()+1)}}}))}function OneBlogComment(Data,Idx){var Bx=$("#OneMsgCmt").clone().removeAttr("id");return Idx=parseInt(Idx,10)+1,Bx.children().first().text(Data.Nm).end().eq(1).html(TextToHTML(Data.Cmt)).end().eq(2).text(Data.Dt).end().last().text("#"+Idx.toString()),Bx}Evt.stopPropagation();var This=$(this),PF=This.closest(".Frm"),Ttl=PF.find("> div:first > span:first").text()+" > 訪客留言",R=[],ID=PF.attr("id").replace("Frm_",""),FrmID="BlogCmtLstFrm_"+ID,Frm=$("#"+FrmID);return Frm.length>0?(R=RelatedFrameRectangle(PF,[Frm.width(),Frm.height()]),FrameShow(Frm,R[0],R[1]),0):(Frm=Frame("#Main",360,320,BlogCommentListFrameSet,"Frm",Ttl,!0),R=RelatedFrameRectangle(PF,[Frm.width(),Frm.height()]),Frm.attr("id",FrmID),FrameShow(Frm,R[0],R[1]),0)}function MessageListFrame(Ttl){function MessageListFrameSet(){return ItemList(LstBx,"service.php",5,{Cmd:3},OneMessage,["LstIdxTg","LstIdxTgDsb"]),$("#NewMsgBtn").on("click",MessageLeaveFrame),$("#RldMsgLstBtn").on("click",MessageListReflash),LstBx.on("click",".OneMsg > input:button:last-child",MessageChainListFrame),LstBx.parent("div")}function OneMessage(Data){var One=$("#OneMsg").clone().removeAttr("id"),ChnBtn=One.attr({id:Data.ID}).children().first().text(Data.Nm).end().eq(1).html(TextToHTML(Data.Msg)).end().eq(2).text(Data.Dt).end().last();return!isNaN(Data.ChnCnt)&&Data.ChnCnt>0?ChnBtn.val(Data.ChnCnt).show():(ChnBtn.val(ChnBtn.attr("title")),One.on({mouseenter:function(){$(this).children("input:button:last").toggle()},mouseleave:function(){$(this).children("input:button:last").toggle()}})),One}function MessageLeaveFrame(Evt){Evt.stopPropagation();var ID="MsgLvFrm",Frm=$("#"+ID),This=$(this),RltFrm=This.closest(".Frm"),LvBx=null,R=null;return Frm.length>0?(LvBx=Frm.find(".LvBx"),R=RelatedFrameRectangle(RltFrm,[Frm.width(),Frm.height()]),LvBx.children("input:text.Ml, textarea").val(""),FrameShow(Frm,R[0],R[1])):(LvBx=$("#LvBx").clone().removeAttr("id"),Frm=Frame("#Main",360,200,function(){return LvBx},"Frm","新留言",!0),R=RelatedFrameRectangle(RltFrm,[Frm.width(),Frm.height()]),LvBx.children("input:button:last").on("click",MessageLeave),Frm.attr("id",ID).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)}),FrameShow(Frm,R[0],R[1])),"string"!=typeof CO.GstNm||0===CO.GstNm.length?LvBx.children("input:text:first").val("").focus().end().find("> label > input:checkbox:first").prop("checked",!1):LvBx.children("input:text.Nm").val(CO.GstNm).focus().end().find("> label > input:checkbox:first").prop("checked",!0),0}function MessageListReflash(){var LstBxDOM=LstBx.get(0),MxLmt=parseInt($("#MxLmt").val(),10);LstBxDOM.LimitSet(MxLmt),LstBxDOM.Recount(function(){LstBxDOM.PageGet(0)})}function MessageChainListFrame(Evt){function ChainFrameSet(){var MsgChnBx=$("#MsgChnBx").clone().removeAttr("id"),LvBx=$("#LvBx").clone().removeAttr("id");return MsgChnBx.children("div:first").replaceWith(HdMsg.clone().removeAttr("id")).end().children("div:first").children("input:button:last").remove().end().end().children("div:last").append(LvBx).children("input:button:first").on("click",MessageLeaveBoxToggle).end().children("div:first").hide().css({padding:5,borderWidth:1,borderRadius:5}).children("input:button:last").on("click",MessageLeave),ItemList(MsgChnBx.children("div:eq(1)"),"service.php",-1,{Cmd:5,ID:ID},OneChain,[]),MsgChnBx}function MessageLeaveBoxToggle(){var This=$(this),LvBx=This.next("div");if("none"===LvBx.css("display")){var Bx=This.parent().parent();This.val("取消留言"),LvBx.show().children("input:text:first").focus(),Bx.parent().animate({scrollTop:Bx.height()},0),"string"==typeof CO.GstNm&&CO.GstNm.length>0&&LvBx.children("input:text:first").val(CO.GstNm).end().find("> label:first > input:checkbox:first").prop("checked",!0)}else This.val("新留言"),LvBx.hide().children("input:text").val("").end().children("textarea").val("")}function OneChain(Data,Idx){var One=$("#OneMsgCmt").clone().removeAttr("id");return Idx=parseInt(Idx,10)+1,One.attr({id:Data.ID}).children().first().text(Data.Nm).end().eq(1).html(TextToHTML(Data.Msg)).end().eq(2).text(Data.Dt).end().eq(3).text("#"+Idx.toString()),One}var R,This=$(Evt.currentTarget),HdMsg=This.parent(),ID=HdMsg.attr("id"),Frm=$("#Msg_"+ID),Ttl=HdMsg.children("div:first").text()+" 的留言串",PF=This.closest(".Frm");return Frm.length>0?(R=RelatedFrameRectangle(PF,[Frm.width(),Frm.height()],[0,This.offset().top-PF.offset().top]),FrameShow(Frm,R[0],R[1]),0):(Frm=Frame("#Main",360,320,ChainFrameSet,"Frm",Ttl,!0),R=RelatedFrameRectangle(PF,[Frm.width(),Frm.height()],[0,This.offset().top-PF.offset().top]),Frm.attr("id","Msg_"+ID),FrameShow(Frm,R[0],R[1],function(){Frm.find("> div:first > span:last > span:eq(1)").click().click()}),Frm.get(0).ChainReload=function(){Frm.find(".MsgChnBx > div:eq(1)").get(0).PageGet(0)},0)}function MessageLeave(){var This=$(this),TgtID=This.closest(".Frm").attr("id").replace(/^Msg_|^MsgLvFrm/,""),SndData={Cmd:4,Nm:Trim(This.prevAll("input:text.Nm:first").val()),Ml:Trim(This.prevAll("input:text.Ml:first").val()),Msg:Trim(This.prevAll("textarea.Msg:first").val())},RmbMe=This.prev("label").children("input:checkbox").prop("checked"),ChkStr="";return 0===SndData.Nm.length&&(SndData.Nm="匿名"),RmbMe?(CookieSet("GstNm",SndData.Nm,CO.LfTm),CO.GstNm=SndData.Nm):(CookieSet("GstNm",SndData.Nm,-1*CO.LfTm),CO.GstNm=""),0===SndData.Ml.length?ChkStr+="尚未填寫 E-Mail。\n":IsEMail(SndData.Ml)||(ChkStr+="E-Mail 不符合標準格式。\n"),0===SndData.Msg.length?ChkStr+="尚未填寫任何留言。\n":SndData.Msg.length>255&&(ChkStr+="留言請勿超個 255 個字。\n"),ChkStr.length>0?(alert("請留意以下說明：\n"+ChkStr),0):("string"==typeof TgtID&&TgtID.length>0&&(SndData.Tgt=TgtID),void $.ajax({type:"POST",dataType:"json",timeout:2e4,url:"service.php",data:SndData,beforeSend:function(){This.get(0).Lock()},error:function(){alert("出錯了!!!")},complete:function(){This.get(0).Unlock()},success:function(Rtn){if(Rtn.Index<0)return alert(Rtn.Index+", "+Rtn.Message),0;var ChnFrm=$("#Msg_"+TgtID);ChnFrm.length>0&&ChnFrm.get(0).ChainReload(),This.parent().prev("input:button").click(),$("#RldMsgLstBtn").click(),FrameHide($("#MsgLvFrm"))}}))}{var ID="MsgBrdFrm",Frm=$("#"+ID),LstBx=$("#MsgLstBx"),Sz=[320,520];$("#BlgLstFrm"),$("#TtlLstFrm")}return Frm.length>0?(FrameShow(Frm),0):(Frm=Frame("#Main",Sz[0],Sz[1],MessageListFrameSet,"Frm",Ttl,!0),Frm.attr({id:ID}).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)}),FrameShow(Frm,BaseFrameXGet(Frm)),0)}function TutorialListFrame(Ttl){function TutorialListSet(){function OneItem(Data,Idx){var Itm=$("<div/>");return Itm.addClass("OneItm OneTtrl").data("URL","text_read.php?Fl="+encodeURIComponent(Data)).attr("name","Tutorial_"+Idx.toString()).text(Data),Itm}function OneTextReadFrameSet(Evt){function TextReadFrameSet(){var Bx=$("<iframe/>");return Bx.attr("src",URL).css({width:Sz[0],height:Sz[1]-1,border:"0px"}),Bx}function TextReadFrameResize(){var SzBx=Frm.children("div:eq(1)");Frm.find("iframe:first").css({width:SzBx.width(),height:SzBx.height()-1})}var This=$(Evt.currentTarget),Ttl=This.text(),URL=This.data("URL"),Sz=[640,480],ID=This.attr("name"),Frm=$("#"+ID);0===Frm.length&&(Frm=Frame("#Main",Sz[0],Sz[1],TextReadFrameSet,"Frm",Ttl,!0),Frm.get(0).ActionExtend("SizeChange",TextReadFrameResize)),FrameShow(Frm,BaseFrameXGet(Frm))}var Bx=$("<div/>");return ItemList(Bx,"service.php",-1,{Cmd:10},OneItem,!0),Bx.on("click","> div",OneTextReadFrameSet),Bx}var ID="TtlLstFrm",Frm=$("#"+ID);return Frm.length>0?(FrameShow(Frm),0):(Frm=Frame("#Main",240,240,TutorialListSet,"Frm",Ttl,!0),Frm.attr({id:ID}).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)}),FrameShow(Frm,BaseFrameXGet(Frm)),0)}function CustomFrame(Ttl){function CustomURLFrameSet(){var Ctn=$('<input type="text"/><br/><span/><br/><input type="button"/>');return Ctn.filter("span:first").text("(部分網站會禁止其它網站的內嵌引用。)").css("color","#ff0000").end().filter("input").css("marginTop",10).filter(":text:first").on("keypress",KeyboardTrigger).end().filter(":button:first").val("確定").addClass("Btn0").on("click",OneCustomFrame),Ctn}function KeyboardTrigger(Evt){13===Evt.keyCode&&$(this).nextAll("input:button:first").click()}function OneCustomFrame(){function OneCustomFrameSet(){var Bx=$("<iframe/>");return Bx.attr("src",URL).css({width:OneSz[0],height:OneSz[1],border:"0px"}),Bx}function OneCustomFrameResize(){var Bx=CstFrm.children("div:eq(1)");Bx.children("iframe").width(Bx.width()).height(Bx.height())}var OneSz=[640,480],URL=$(this).prevAll("input:text").val();if(0===URL.length)return 0;var URLHd=URL.substr(0,7);"http://"!==URLHd&&"https:/"!==URLHd&&(URL="http://"+URL),FrameHide(Frm);var Bs=$("#Main"),CstFrm=Frame("#Main",OneSz[0],OneSz[1],OneCustomFrameSet,"Frm",URL,!0);return CstFrm.get(0).ActionExtend("SizeChange",OneCustomFrameResize),FrameShow(CstFrm,(Bs.width()-CstFrm.outerWidth())/2,Bs.offset().top+5),0}var ID="CstURLFrm",Frm=$("#"+ID),Sz=[320,100];if(Frm.length>0)return FrameShow(Frm,null,null,function(){Frm.find("> div:eq(1) > input:text:first").focus()}),0;Frm=Frame("#Main",Sz[0],Sz[1],CustomURLFrameSet,"Frm",Ttl,!0),Frm.attr({id:ID}).get(0).ActionExtend("CloseButtonClick",function(){FrameHide(Frm)});var Bs=$("#Main"),Txt=Frm.children("div:eq(1)").css("textAlign","center").children("input:text:first");return FrameShow(Frm,(Bs.width()-Frm.outerWidth())/2,Bs.offset().top+5,function(){Txt.focus()}),0}function GoodWordsSet(){function NowWordGet(){$.ajax({type:"POST",dataType:"json",timeout:2e4,url:"service.php",data:{Cmd:11},success:function(Data){return Data.Index<0?-1:(Str=Data.Extend.Wds,Initialize(),void Animate())}})}function Initialize(){Cvs.attr({width:Cvs.width(),height:Cvs.height()}),Ctx=Cvs.get(0).getContext("2d"),Ctx.textBaseline="middle";for(var BsSptA=[40,25],StrA=Str.replace(/\n|，|；|。| /g,"\n").split("\n"),i=0;i<StrA.length;i++)for(var BsLct=[80,Ctx.canvas.height-BsSptA[1]*(StrA.length-i+1)],j=0;j<StrA[i].length;j++){var Chr=StrA[i].charAt(j),Clr=[RandomRange(64,128).toString(),RandomRange(64,192).toString(),RandomRange(64,255).toString(),RandomRange(.2,.9,2).toString()],Sz=RandomRange(20,50),Wd={Chr:Chr,DftLct:[BsLct[0]+j*BsSptA[0]+RandomRange(-5,5),BsLct[1]+RandomRange(-5,5)],Lct:[RandomRange(0,Ctx.canvas.width,2),RandomRange(0,Ctx.canvas.height,2)],Drct:[RandomRange(-1,1,2),RandomRange(-1,1,2)],Sz:Sz,Clr:"rgba("+Clr[0]+", "+Clr[1]+", "+Clr[2]+", "+Clr[3]+")",Fnt:"italic bold "+Sz.toString()+"px sans-serif"};Wds.push(Wd)}}function Animate(){Ctx.clearRect(0,0,Ctx.canvas.width,Ctx.canvas.height),AlignedStand()}function AlignedStand(){for(var i=0;i<Wds.length;i++)Wds[i].Lct[0]=Wds[i].DftLct[0],Wds[i].Lct[1]=Wds[i].DftLct[1],Ctx.font=Wds[i].Fnt,Ctx.fillStyle=Wds[i].Clr,Ctx.shadowOffsetX=0,Ctx.shadowOffsetY=0,Ctx.shadowBlur=0,Ctx.fillText(Wds[i].Chr,Wds[i].Lct[0],Wds[i].Lct[1])}function RandomRange(Min,Max,Dcm){if("number"!=typeof Min||"number"!=typeof Max)return 0;if("number"!=typeof Dcm&&(Dcm=0),Min>Max||Min>Max){var T=Min;Min=Max,Max=T}var Dst=Max-Min,Nbr=Math.random()*Dst+Min;if(0===Dcm)Nbr=Math.floor(Nbr);else if(Dcm>0){var Pow=Math.pow(10,Dcm);Nbr=Math.floor(Nbr*Pow)/Pow}return Nbr}var Str="",Cvs=$("canvas#GdWds"),Ctx=null,Wds=[];return NowWordGet(),0}function ArtCornerSet(){function RandomOne(){$.ajax({type:"POST",dataType:"json",timeout:2e4,url:"service.php",data:{Cmd:6},success:function(Data){return Data.Index<0?-1:void AtCnr.css("backgroundImage",'url("'+Data.Extend.ImgURL+'")').children().text(Data.Extend.Ttl+"\n"+Data.Extend.Dt.substr(0,10)+"\nby "+Data.Extend.Atr)}})}var AtCnr=$("#AtCnr"),AtCnrChk=$("#AtCnrChk");return AtCnrChk.on({mouseenter:function(){AtCnr.children().show()},mouseleave:function(){AtCnr.children().hide()}}),RandomOne(),AtCnr}function KeyboardCommand(Pg){function ToAdminCheck(Evt){var KyBfr=Dcm.data("KyBfr")+Evt.keyCode.toString(16),MpA=["41444d494e","525a","55504c4f4144"],MpL=0;for(var i in MpA)MpL=Math.max(MpL,MpA[i].length);KyBfr.length>MpL&&(KyBfr=KyBfr.substr(2)),KyBfr.indexOf(MpA[0])>=0?(Dcm.data("KyBfr",""),PageTurn("admin.php")):KyBfr.indexOf(MpA[1])>=0?(Dcm.data("KyBfr",""),PageTurn("rz.php")):KyBfr.indexOf(MpA[2])>=0?(Dcm.data("KyBfr",""),PageTurn("upload/upload.php")):Dcm.data("KyBfr",KyBfr)}if("string"!=typeof Pg)return 0;var Dcm=$(document),Fctn=function(){};return(0===Pg.length||"index.php"===Pg)&&(Fctn=ToAdminCheck),Dcm.data("KyBfr","").keyup(Fctn),0}